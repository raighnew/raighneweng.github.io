+++
title = '屠龙记之灾备'
date = 2024-02-28T14:12:16+08:00
tags = ["IT"]
+++

最近面试考官问了一题跟灾备有关的问题，在我看来这都是PPT里的的设计，所以回答的不是很好，整理一下发出来。

### 同城双中心主备切换

在同一个城市部署两个可用机房：

- 机房用高速专线连接，网络延时极低对业务可以忽略不计。
- 服务器数据通过专线同步。

当主机房发生故障时，通过DNS切换将流量切换到备用机房。


### 同城双中心双活架构

双活解决了主备方案的两个问题：
- 主备切换方案长期处于冷备状态，资源利用率非常低。
- 主备切换方案会随着业务迭代，故障率会升高。

无状态的接入层和服务层双活部署无需改造，需要改造数据持久层。

- 无状态的接入层和服务层双活部署，有状态的存储层主备部署(机房2的Write请求通过Proxy写入机房1的MySQL，在通过同步复制将数据持久化道机房2)
- 依赖于网络高速专线，假如专线故障同步中断将会造成服务中断，需要切换流量道主机房.